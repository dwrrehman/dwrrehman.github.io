<!DOCTYPE html>
<html><head>
	<title>dwrr</title>
	<style>
		#terminal {
			color: #3AFD33;
			font-family: Menlo;
			font-weight: lighter;
			font-size: 20px;
			line-height: 20px;
			width: screen.width;
			height: screen.height;
		}

		*:focus { outline: none; }

		html, body {
			padding: 0; 
			margin: 0;
			border: none;
			background: black;
		}
	</style>
	<script> 

		// const example_html_string = "\
		// listing not available right now.<br>\
		// <a href='https://www.w3schools.com'>https://www.w3schools.com</a><br>\
		// <img src='dog.JPG' title='this is a dog' width='128' height='128'><br>"
		//  <img> tag.
		//  <iframe> tag.
		//  <video> and <audio>  tag
		// 

	/*		<object data="/path_to_text_file/text.txt" type="text/plain"
		width="500" style="height: 300px">
		<a href="/path_to_text_file/text.txt">No Support?</a>
			</object>

	// "<iframe src=\"text.txt\" id=\"terminal\" frameborder=\"0\" \
		// height=\"400\" width=\"600\" ></iframe> <br>"
	*/


		const prompt_emblem = "::"

		const welcome_message = "\
		This is the terminal interface for Daniel Rehman's website. (version 0.0.0) <br>\
		Type \"h\" for more info.<br>";

		const help_message = "\
		<br>\
		h [cmd]  :  help: help manual <br>\
		a (file) :  about: unimplemented <br>\
		w        :  where: print current directory <br>\
		e        :  edit: unimplemented <br>\
		f [file] :  file: display file <br>\
		j [file] :  jump: change directory (default /)<br>\
		i (file) :  insp: unimplemented <br>\
		o (file) :  open: open media file (unix: less) <br>\
		l        :  clear: clear screen (unix: clear) <br>\
		<br>"

		
		const manual = ["/documents/manual/help.txt",  "/documents/manual/about.txt", 
				"/documents/manual/where.txt", "/documents/manual/edit.txt", 
				"/documents/manual/file.txt",  "/documents/manual/jump.txt", 
				"/documents/manual/i.txt",     "/documents/manual/o.txt", 
				"/documents/manual/clear.txt"]

		var terminal = null
		var pwd = "/"

		function run(command) {

			let command_parts = command.split(" ")
			let c = command_parts[0]
			if (command_parts.length > 0) c = command_parts[0]

			let arg = ""
			if (command_parts.length > 1) arg = command_parts[1]
			
			console.log(command_parts, c, arg);

			if (c === "" || c === "nbsp;") return "";

			else if (c === "h") {
				if (arg == "") return help_message
				else if (arg === "h") return text_to_html(file_contents(manual[0]));
				else if (arg === "a") return text_to_html(file_contents(manual[1]));
				else if (arg === "w") return text_to_html(file_contents(manual[2]));
				else if (arg === "e") return text_to_html(file_contents(manual[3]));
				else if (arg === "f") return text_to_html(file_contents(manual[4]));
				else if (arg === "j") return text_to_html(file_contents(manual[5]));
				else if (arg === "i") return text_to_html(file_contents(manual[6]));
				else if (arg === "o") return text_to_html(file_contents(manual[7]));
				else if (arg === "l") return text_to_html(file_contents(manual[8]));
				else return "?<br>"
			}

			// about command:
			else if (c === "a") return "command unimpemented. <br>"
			
			else if (c === "w") return pwd + "<br>"

			else if (c === "e")
				if (arg !== "")
					return text_to_html(file_contents(pwd + arg))
				else return "error: filename argument required<br>"

			else if (c === "f" || c === "ls" || c === "sl")  {
				if (arg !== "") arg += "/"
				return text_to_html(file_contents(pwd + arg + "_index.txt")) 
			}

			else if (c === "j" || c === "cd") {

				let save = pwd
				if (arg === "") { pwd = "/"; return "" }
				for (const part of arg.split("/")) {
					if (part === "" || part === ".") {}
					else if (part === "..") {
						if (pwd !== "/") {
							pwd = pwd.slice(0, -1)
							pwd = pwd.slice(0, pwd.lastIndexOf("/") + 1)
						}
					} else {
						let valid = false;
						files = file_contents(pwd + "_index.txt").split("\n")
						for (const file of files) 
							if (file.indexOf('.') === -1 && file === part) valid = true;

						if (valid === true) pwd += part + "/"
						else {
							pwd = save;
							return "jump: no such directory \"" + arg + "\"<br>"
						}
					}
				}
				return ""
			}
			
			// inspect command
			else if (c === "i") return  "inspect command unimplemented. <br> "

			// open command
			else if (c === "o") return "open command unimplemented.<br>";

			else if (c === "l") { terminal.innerHTML = ""; return ""; }

			return "?<br>"
		}

		function text_to_html(html) {
			let text = ""
			for (let i = 0; i < html.length; i++) {
				if (html[i] === '\n') text += "<br>"
				else if (html[i] === '\t') text += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
				else if (html[i] === ' ' && html[i + 1] === ' ') text += "&nbsp;"
				else text += html[i];
			}
			return text
		}
		
		/*function append_file_async(path) {
  			var xhttp = new XMLHttpRequest();
  			xhttp.onreadystatechange = function() {
    				if (this.readyState == 4 && this.status == 200) 
					terminal.innerHTML += text_to_html(this.responseText);
			};
  			xhttp.open("GET", path, true);
  			xhttp.send();
		}*/

		function file_contents(path) {
  			var result = null;
  			var xmlhttp = new XMLHttpRequest();
  			xmlhttp.open("GET", path, false);
  			xmlhttp.send();
  			if (xmlhttp.status == 200) result = xmlhttp.responseText;
			else if (xmlhttp.status == 404) result = "error: 404: file not found : \"" + path + "\""
			return result;
		}

		function input(event) {
			event = event || window.event
			if (event.key === "Enter") {
				let start = terminal.innerHTML.lastIndexOf(prompt_emblem) + prompt_emblem.length + 1
				terminal.innerHTML = terminal.innerHTML.slice(0, -15)
				let command = terminal.innerHTML.slice(start, terminal.innerHTML.length);
				terminal.innerHTML += "<br>"
				let output = run(command)
				terminal.innerHTML += output + prompt_emblem + "&nbsp;"
			}
			terminal.focus();
			var range = document.createRange();
			range.selectNodeContents(terminal);
			range.collapse(false);
			var sel = window.getSelection();
			sel.removeAllRanges();
			sel.addRange(range);
		}

		window.onload = function() {
			terminal = document.getElementById("terminal")
			terminal.innerHTML = welcome_message + prompt_emblem + "&nbsp;"
			document.addEventListener('keyup', input, false);

			terminal.focus();
			var range = document.createRange();
			range.selectNodeContents(terminal);
			range.collapse(false);
			var sel = window.getSelection();
			sel.removeAllRanges();
			sel.addRange(range);
		}
	</script>
</head>
<body>
	<div 
	id="terminal" 
	contenteditable="true"
	spellcheck="false"
	autocomplete="off"
	autocorrect="off" 
	autocapitalize="off"
	></div>

</body></html>







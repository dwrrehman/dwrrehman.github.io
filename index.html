<!DOCTYPE html>
<html><head>
	<title>dwrr</title>
	<style>
		#terminal {
			color: #3AFD33;
			font-family: Menlo;
			font-weight: lighter;
			font-size: 20px;
			line-height: 20px;
			width: screen.width;
			height: screen.height;
		}

		*:focus { outline: none; }

		html, body {
			padding: 0; 
			margin: 0;
			border: none;
			background: black;
		}
	</style>
	<script> 

		// const example_html_string = "\
		// listing not available right now.<br>\
		// <a href='https://www.w3schools.com'>https://www.w3schools.com</a><br>\
		// <img src='dog.JPG' title='this is a dog' width='128' height='128'><br>"
		//  <img> tag.
		//  <iframe> tag.
		//  <video> and <audio>  tag
		// 

	/*		<object data="/path_to_text_file/text.txt" type="text/plain"
		width="500" style="height: 300px">
		<a href="/path_to_text_file/text.txt">No Support?</a>
			</object>

	// "<iframe src=\"text.txt\" id=\"terminal\" frameborder=\"0\" \
		// height=\"400\" width=\"600\" ></iframe> <br>"
	*/


		const prompt_emblem = "::"

		const welcome_message = "\
		This is the terminal interface for Daniel Rehman's website. (version 0.0.4) <br>\
		Type \"help\" for more info.<br>";

		const help_message = "\
		<br>\
		help [cmd] :  help manual (unix man) (abbrev: h) <br>\
		where : print current directory (unix pwd) (abbrev: w) <br>\
		show (file) : display text file contents (unix cat) (abbrev: e) <br>\
		list [file] : list files (unix: ls) (abbrev: f) <br>\
		jump [file] : change directory (unix cd) (abbrev: j) <br>\
		open (file) : open media file in new window (abbrev: o) <br>\
		--- :  unimplemented <br>\
		--- :  unimplemented <br>\
		clear : clear screen (unix clear) <br>\
		<br>"

		var terminal = null
		var pwd = "/"

		function run(command) {

			let command_parts = command.split(" ")
			let c = ""
			let arg = ""
			if (command_parts.length > 0) c = command_parts[0]			
			if (command_parts.length > 1) arg = command_parts[1]
			console.log(command_parts, c, arg);

			if (c === "" || c === "nbsp;") return "";

			else if (c === "l" || c === "clear") { terminal.innerHTML = ""; return ""; }

			else if (c === "w" || c === "show") return pwd + "<br>"

			else if (c === "e" || c === "cat" || c === "show") {
				if (arg === "") return "error: filename argument required<br>"
				return text_to_html(file_contents(pwd + arg))
			
			} else if (c === "f" || c === "ls" || c === "list")  {
				if (arg !== "") arg += "/"
				return text_to_html(file_contents(pwd + arg + "index.txt")) 
			}

			else if (c === "o" || c === "open" ) {
				if (arg === "") return "error: filename argument required<br>"
				window.open(pwd + arg)
				return ""
			}

			else if (c === "h" || c === "man" || c === "help") {

				if (arg == "") return help_message

				else if (arg === "help") 
					return text_to_html(file_contents("/documents/manual/help.txt"));

				else if (arg === "about") 
					return text_to_html(file_contents("/documents/manual/about.txt"));

				else if (arg === "where") 
					return text_to_html(file_contents("/documents/manual/where.txt"));

				else if (arg === "show") 
					return text_to_html(file_contents("/documents/manual/show.txt"));

				else if (arg === "list") 
					return text_to_html(file_contents("/documents/manual/list.txt"));

				else if (arg === "jump") 
					return text_to_html(file_contents("/documents/manual/jump.txt"));

				else if (arg === "inspect") 
					return text_to_html(file_contents("/documents/manual/inspect.txt"));

				else if (arg === "open") 
					return text_to_html(file_contents("/documents/manual/open.txt"));

				else if (arg === "clear") 
					return text_to_html(file_contents("/documents/manual/clear.txt"));

				else return "error: no manual entry for \"" + arg + "\".<br>"
			}

			

			else if (c === "j" || c === "cd" || c === "jump") {

				let save = pwd
				if (arg === "") { pwd = "/"; return "" }

				for (const part of arg.split("/")) {
					if (part === "" || part === ".") {}
					else if (part === "..") {
						if (pwd !== "/") {
							pwd = pwd.slice(0, -1)
							pwd = pwd.slice(0, pwd.lastIndexOf("/") + 1)
						}
					} else {
						let valid = false;
						files = file_contents(pwd + "index.txt").split("\n")
						for (const file of files) 
							if (file.indexOf('.') === -1 && file === part) valid = true;

						if (valid === true) pwd += part + "/"
						else {
							pwd = save;
							return "jump: no such directory \"" + arg + "\"<br>"
						}
					}
				}
				return ""
			}
			
			// inspect command?
			else if (c === "i") return "command unimplemented. <br> "

			// about command?
			else if (c === "a") return "command unimpemented. <br>"
		
			return "?<br>"
		}

		function text_to_html(html) {
			let text = ""
			for (let i = 0; i < html.length; i++) {
				if (html[i] === '\n') text += "<br>"
				else if (html[i] === '\t') text += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
				else if (html[i] === ' ' && html[i + 1] === ' ') text += "&nbsp;"
				else text += html[i];
			}
			return text
		}
		
		/*function append_file_async(path) {
  			var xhttp = new XMLHttpRequest();
  			xhttp.onreadystatechange = function() {
    				if (this.readyState == 4 && this.status == 200) 
					terminal.innerHTML += text_to_html(this.responseText);
			};
  			xhttp.open("GET", path, true);
  			xhttp.send();
		}*/

		function file_contents(path) {
  			var result = null;
  			var xmlhttp = new XMLHttpRequest();
  			xmlhttp.open("GET", path + "?_=" + new Date().getTime(), false);
  			xmlhttp.send();
  			if (xmlhttp.status == 200) result = xmlhttp.responseText;
			else if (xmlhttp.status == 404) result = "error: 404: file not found : \"" + path + "\""
			return result;
		}

		function input(event) {
			event = event || window.event
			if (event.key === "Enter") {
				let start = terminal.innerHTML.lastIndexOf(prompt_emblem) + prompt_emblem.length + 1
				terminal.innerHTML = terminal.innerHTML.slice(0, -15)
				let command = terminal.innerHTML.slice(start, terminal.innerHTML.length);
				terminal.innerHTML += "<br>"
				let output = run(command)
				terminal.innerHTML += output + prompt_emblem + "&nbsp;"
			}
			terminal.focus();
			var range = document.createRange();
			range.selectNodeContents(terminal);
			range.collapse(false);
			var sel = window.getSelection();
			sel.removeAllRanges();
			sel.addRange(range);
		}

		window.onload = function() {
			terminal = document.getElementById("terminal")
			terminal.innerHTML = welcome_message + prompt_emblem + "&nbsp;"
			document.addEventListener('keyup', input, false);

			terminal.focus();
			var range = document.createRange();
			range.selectNodeContents(terminal);
			range.collapse(false);
			var sel = window.getSelection();
			sel.removeAllRanges();
			sel.addRange(range);
		}
	</script>
</head>
<body>
	<div 
	id="terminal" 
	contenteditable="true"
	spellcheck="false"
	autocomplete="off"
	autocorrect="off" 
	autocapitalize="off"
	></div>

</body></html>






